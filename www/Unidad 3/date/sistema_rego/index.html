<!DOCTYPE html>
<html lang="gl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculador de Períodos de Rego Automático</title>
</head>

<body>
    <h1>Calculador de Períodos de Rego Automático</h1>
    <p>Baseado nas fases lunares, este sistema calcula a frecuencia de rego
        para unha horta.</p>
    <button onclick="mostrarProximoRego()">Calcular próximo día de
        rego</button>
    <p id="resultado"></p>
    <script>
        // Data de referencia para a última lúa nova
        const dataReferencia = new Date('2024-01-11');
        // Función para calcular o número de días pasados desde a última lúa nova
        function diasDesdeLuaNova(dataActual) {
            const diferenzaMS = dataActual - dataReferencia; // diferencia en MS
            const diferenzaDias = diferenzaMS / (1000 * 60 * 60 * 24); // diferncia en días
            return Math.floor(diferenzaDias % 29.53); //29.53 son los días que tiene cada ciclo lunar y el módulo te da los días desde la última luna nueva.
        }
        // Función para determinar a fase lunar en función do número de días desde a lúa nova
        function faseLunar(dias) {
            return dias >= 0 && dias <= 7 ? 'Nova':
            dias >= 8 && dias <= 14 ? 'Crecente':
            dias >= 15 && dias <= 22 ? 'Chea':
            dias >= 23 && dias <= 29 ? 'Minguante': 'Nova';
        }
        // Función para determinar a frecuencia de rego en función da fase lunar
        function frecuenciaRego(fase) {
              switch(fase){
                case 'Nova':
                    return 2;
                    break;
                case 'Crecente':
                    return 3;
                    break;
                case 'Chea':
                    return 5;
                    break;
                case 'Minguante':
                    return 4;
                    break;
            }
        }
        // Función para calcular a próxima data de rego en función do día actual e da frecuencia de rego
        function proximoDiaRego(dataActual) {
            const  diaLuna = diasDesdeLuaNova(dataActual);
            const faseLuna = faseLunar(diaLuna);
            let futura = new Date(dataActual);
            futura.setDate(futura.getDate() + frecuenciaRego(faseLuna)) //Fago un setDate e sumo 
            return {
                fase: faseLuna,
                proximaData: futura.toLocaleDateString()
            };
        }
        // Función para mostrar o resultado na páxina web
        function mostrarProximoRego() {
            const dataActual = new Date();
            const resultado = proximoDiaRego(dataActual);
            document.getElementById("resultado").innerHTML =
                `Fase lunar actual: ${resultado.fase} <br> Próximo rego será o: ${resultado.proximaData}`
                ;
        }
    </script>
</body>

</html>